{% load static %}

<!doctype html>
<html lang="en">
    <head>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="{% static 'img/THW.ico' %}"/>

        <!-- JQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <title>THW DEMO</title>



        <!-- Add Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

        <!-- Add Leaflet JavaScript -->
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
        <script src="https://unpkg.com/neovis.js/dist/neovis.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        <!-- custom JS-->
        <script src="{% static 'js/main.js'%}"></script>

        <script src="https://unpkg.com/neo4j-driver@5.2.0/lib/browser/neo4j-web.min.js"></script>
        <script src="//unpkg.com/three"></script>
        <script src="//unpkg.com/three-spritetext"></script>
        <script src="//unpkg.com/3d-force-graph"></script>

        <!--custom CSS-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/tabs.css' %}">
        <!--New library vis.js-->
        <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.js"></script>

    </head>

    <body>

        <!--HEADER-->

        <div class="header">
            <div class="header-left">
                <img src="{% static 'img/pairs-logo.jpg' %}" alt="Image Description" style="height:70px;">
            </div>

            <div class="header-center">
                <a  href="https://www.dfki.de/web/forschung/projekte-publikationen/projekte-uebersicht/projekt/pairs/">
                    <span class="my_title">Operations Planning in Civil Protection</span>
                </a>
            </div>

            <div class="header-right">
                <img src="{% static 'img/dfki_logo.jpg' %}" alt="Image DFKI" style="height:70px;">
                <img src="{% static 'img/Bundesmini.png' %}" alt="Image Bindes Mini" style="height:70px;">
            </div>
        </div>

        <br>

        <!--MAIN-->

        <div class="container">

            <div id="statements">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="data-visual-tab" data-bs-toggle="tab" data-bs-target="#data-visual" type="button" role="tab" aria-controls="data-visual" aria-selected="true">Introduction & Historical data</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="event-pred-tab" data-bs-toggle="tab" data-bs-target="#event-pred" type="button" role="tab" aria-controls="event-pred" aria-selected="false">Event Prediction</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="plan-recom-tab" data-bs-toggle="tab" data-bs-target="#plan-recom" type="button" role="tab" aria-controls="plan-recom" aria-selected="false">Recommendations</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="scenar-pattern-tab" data-bs-toggle="tab" data-bs-target="#scenar-pattern" type="button" role="tab" aria-controls="scenar-pattern" aria-selected="false">Background Information</button>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="data-visual" role="tabpanel" aria-labelledby="data-visual-tab">

                        <div class="row" id="operation-planing">

                            <p class="inside-tab" style="font-weight:bold;">Operations Planning</p>
                            <p class="inside-tab" style=" padding-top:0px;">
                                Civil protection units increasingly face the challenge of ad hoc large-scale, cross-regional disasters requiring effective plans for their operations.
                                Variables like time of response, allocation of resources, tasks and personnel pose critical success factors to crisis operations and these operation plans.
                                So far operations planning relies on manual processes and individual experience,
                               neglecting collected historical knowledge, which leads to inefficient responses.
                                In cooperation with the German Federal Agency for Technical Relief (German abbr. THW), we aim to support operation planning within the domain of civil defense to increase resource efficiency, save time and costs.
                                By using a forecasting model we predict crisis events and generate recommendations based on semantically enhanced historical knowledge (for more technical details see Background Information tab).
                            </p>

                            <p class="inside-tab" style="font-weight:bold;">Historical Operations Data</p>
                            <div class="col">
                                <p class="inside-tab">Historical operation data collected by THW (2012-2021) serve as initial data basis and input for our service.
                                    The dataset includes information about the requesting party of the operation, date, event type of the operation, concrete tasks and a description, number of deployed helpers and their conducted duty hours.
                                    The table serves as data sample. We further used similar datasets on helpers and personnel (including qualifications, location, gender, age), data on units  (name, abbreviation, strength, tasks, roles, qualifications, equipment) and data on operation options (event type, subevents, tasks).
                                </p>
                                <p  class="inside-tab">By analyzing the historical dataset valuable patterns, trends and insights can be derived to gain additional information on THW’s operations.
                                </p>
                            </div>
                            <div class="col">

                                <table id="table-data">
                                    <thead>
                                    <tr>
                                        <th>Requester</th>
                                        <th id="event-type-col">Event Type</th>
                                        <th>Task</th>
                                        <th>Description</th>
                                        <th>Service Project</th>
<!--                                        <th>Number of Helpers</th>
                                        <th>Duty Hours</th>
                                        <th>ID</th>-->
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for row in df_withonout_nan_custom.values %}
                                        <tr>
                                        <td>{{ row.0 }}</td>
                                        <td>{{ row.1 }}</td>
                                        <td>{{ row.2 }}</td>
                                        <td>{{ row.3 }}</td>
                                        <td>{{ row.4 }}</td>
<!--                                        <td>{{ row.5 }}</td>
                                        <td>{{ row.6 }}</td>
                                        <td>{{ row.7 }}</td>-->
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <p class="inside-tab" style="font-weight:bold;">Analysis of Historical Operations</p>
                            {% comment %} Slide 10 {% endcomment %}
                            <p class="inside-tab" style=" padding-top:0px;">
                                The chart in Figure 1 illustrates the correlation between the duration of duty hours and the requesting party.
                                It can be seen that state authorities (<i>Landesbehörden</i>) have requested approximately 1200 duty hours, followed by municipalities (<i>Gemeinden</i>) and fire departments (<i>Feuerwehr</i>).
                            ​</p>


                            <img id="plot_requester_dutyHours" alt="plot_requester_dutyHours" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 1. Relationship between duty hours and requester.​</p>

                            {% comment %} SLide 11  {% endcomment %}
                            <p class="inside-tab" style=" padding-top:0px;">
                                Figure 2 depicts the association between quantity of helpers and the requesting party. Fire departments (<i>Feuerwehr</i>) have the highest demand, requesting 90 workers on average. On the other hand,
                                ​<i>Zoll</i> has the least demand, requesting approximately 5 workers. The figure showcases the contrasting levels of worker requirements among these organizations.
                            </p>

                            <img id="plot_requester_helperss" alt="plot_requester_helperss" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 2. Relationship between number of helpers and requester.​​</p>

                            {% comment %} SLide 12  {% endcomment %}
                            <p class="inside-tab" style=" padding-top:0px;"
                                >Figure 3  showcases the duty hours spent on different tasks. Infrastructure tasks (<i>Infrastruktur, Temporärer Aufbau</i>) required approximately 12000 duty hours.
                                This visual depiction contributes to a deeper understanding of the allocation and distribution of work hours concerning different tasks.
                            </p>

                            <img id="plot_dutyHours_missionTask" alt="plot_dutyHours_missionTask" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 3. Relationship between duty hours and task.​​​</p>

                            {% comment %} SLide 13  {% endcomment %}
                            <p class="inside-tab" style=" padding-top:0px;">
                                Figure 4  showcases which tasks required the highest numbers of helpers. Technical help (<i>Technische Hilfe im Rahmen sonstiger Hilfeleistungen</i>) requires 90 helpers on average.
                            </p>

                            <img id="plot_helpers_missionTask" alt="plot_helpers_missionTask" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 4. Relationship between number of helpers and task.​​​​</p>

                            {% comment %} SLide 14  {% endcomment %}
                            <p class="inside-tab" style=" padding-top:0px;">
                                Figure 5 and Figure 6 highlight how many helpers and duty hours are required for technical help in contrast to all other operations.​
                            </p>

                            <img id="plot_dutyHours_typeOfService" alt="plot_dutyHours_typeOfService" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 5. Relationship between duty hours and type of service.​​​​​</p>
                            <img id="plot_helpers_typeOfService" alt="plot_helpers_typeOfService" style="width: 50%;">
                            <p class="inside-tab" id="caption">Figure 6. Relationship between number of helpers and type of service.​​​​​​</p>

                        </div>

                        <script>
                            var plots_for_overview = 'Static'
                            if(plots_for_overview === 'Dynamic'){
                                $('#plot_requester_dutyHours').attr('src', 'data:image/png;base64,{{ plot_requester_dutyHours }}');
                                $('#plot_requester_helperss').attr('src', 'data:image/png;base64,{{ plot_requester_helperss }}');
                                $('#plot_dutyHours_missionTask').attr('src', 'data:image/png;base64,{{ plot_dutyHours_missionTask }}');
                                $('#plot_helpers_missionTask').attr('src', 'data:image/png;base64,{{ plot_helpers_missionTask }}');
                                $('#plot_dutyHours_typeOfService').attr('src', 'data:image/png;base64,{{ plot_dutyHours_typeOfService }}');
                                $('#plot_helpers_typeOfService').attr('src', 'data:image/png;base64,{{ plot_helpers_typeOfService }}');
                            } else if (plots_for_overview === 'Static'){
                                $('#plot_requester_dutyHours').attr('src', `{% static "img/plot_requester_dutyHours.svg" %}`);
                                $('#plot_requester_helperss').attr('src', `{% static "img/plot_requester_helperss.svg" %}`);
                                $('#plot_dutyHours_missionTask').attr('src', `{% static "img/plot_dutyHours_missionTask.svg" %}`);
                                $('#plot_helpers_missionTask').attr('src', `{% static "img/plot_helpers_missionTask.svg" %}`);
                                $('#plot_dutyHours_typeOfService').attr('src', `{% static "img/plot_dutyHours_typeOfService.svg" %}`);
                                $('#plot_helpers_typeOfService').attr('src', `{% static "img/plot_helpers_typeOfService.svg" %}`);
                            }
                        </script>

                    </div>
                    <div class="tab-pane fade" id="scenar-pattern" role="tabpanel" aria-labelledby="scenar-pattern-tab" style="width: 100%;">
                        <div class="row">
                            <!--INSIDE OF OPENNED TAB-->
                            <p class="inside-tab" style="font-weight:bold; text-align: left">What are Operational Scenario Patterns?</p>
                            <p class="inside-tab" style=" padding-top:0px;">Operational Scenario Patterns provide descriptive information about the conceptual structure of crisis situations by highlighting and interlinking information sources.
                                Scenario Patterns serve as blueprint to describe historical operations semantically in a story-telling way. Main entities (orange) include contextual information of a crisis, reason, impact and location, involved actors, measures, resources involved within these measures, the provenance of the information and interlinked historical events.
                                Each Entitiy has individual attributes as presented in the following figure
                            </p>

                            <center><img src="{% static 'img/scenario.svg' %}" alt="duty_hours_and_requesters" style="width:38%">
                            <p  id="caption">Figure 1. Overview of perational scenario pattern entities </p>

                            <p class="inside-tab" style=" padding-top:0px;">
                                We implemented Operational Scenario Patterns within a semantic description using JSON-LD as a human understandable and easy-to-read format.
                                All entities were mapped onto semantic web standards such as the vocabularies and ontologies FOAF, beAware , LODE , Empathi and schema.org. Resulting descriptions form a knowledge network that can further be transferred into a knowledge graph database Neo4j by using cypher script (see Knowledge Graph tab for an example).
                            </p>
                            <p class="inside-tab" style=" padding-top:0px;">
                                The historical operations data by THW are mapped onto the operational scenario patterns structure.
                                Generated recommendations are mapped onto the structure as well, serving as operation plans to be shared with unit leaders and other helpers and responders (see Recommendation tab).
                            </p>
                        </div>


                    </div>
                    <div class="tab-pane fade" id="knowledge-graph" role="tabpanel" aria-labelledby="knowledge-graph-tab">
                        <!--INSIDE OF OPENNED TAB-->
                        <div class="row">
                            <img src="{% static 'img/info_icon.png' %}" alt="duty_hours_and_requesters" style="height: 15px;width: 40px; margin-left: 20px;">
                            <span class="inside-tab" style=" padding-top:0px;padding-bottom: 10px; ">
                                Within this tab, we provide an excerpt of the historical knowledge on operations as an explorable knowledge graph, generated by mapping THW's operation data onto the scenario pattern structure.
                                We conducted inferencing algorithms to connect these data nodes with the additional data on personnel, units and operation options in order to derive non-evident knowledge that was not stored in the original database by THW before.
                                The knowledge graph then serves as basis for the generated planning recommendations (Recommendation tab) for predicted events (Event Prediction tab).
                            </span>

                            {% comment %} GRAPH {% endcomment %}
                            <div id="graph-container"></div>
                            <div id="graph-container-popup" style="position: relative; top: -190px; left: 930px;"></div>

                            <!--Generate Graph-->
                            {% comment %} <script src="{% static 'js/knowladge-graph-tab.js'%}"></script> {% endcomment %}

                        </div>
                    </div>
                    <div class="tab-pane fade" id="event-pred" role="tabpanel" aria-labelledby="event-pred-tab">
                        <!--INSIDE OF OPENNED TAB-->
                        <div class="row">

                            <p class="inside-tab" style="font-weight:bold;">Description</p>

                            <p class="inside-tab" style=" padding-top:0px;">
                                Using predictive analytical methods on the historical operation data in combination with additional historical weather data, we trained our forecasting model in order to predict potential future operations. To increase the quality of our prediction, individual operations of the data set were clustered into weather-based categories (flood events, rain events, snow events and others).
The following graphs provide a prediction for each category for a selected city.
                                Predicted events are highlighted (red nodes), as well as the prediction that an event will not happen (green nodes). The threshold (orange line) marks the confidence of the forecasting model in the prediction (probability of occurrence). The map below provides additional weather information per location and predicted event.
                            </p>



                            <div id="flood-prediction" style="border: 1px solid #000;border-radius: 5px; margin: 50px;width: 96%;height: 1300px">
                                <div style="background: white; position: relative; top: -16px; width: 76px; padding: 2px;">Prediction</div>
                                {% comment %} Content {% endcomment %}
                                <div class="row">
                                    <div class="col">
                                        {% comment %} 1 raw {% endcomment %}
                                        <div class="row" style="display: flex; justify-content: center;margin: 40px 0px;">
                                            <select id="city-dropdown" onChange="jsFunction()" style="width: 350px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; background-color: #f5f5f5;">

                                              <script>
                                              function jsFunction(){
                                                var myselect = document.getElementById("city-dropdown");
                                                var value = '';
                                                if (myselect.value == "muelheim") {
                                                  value = "mühlheim";
                                                }
                                                else if (myselect.value == "bernkastel_kues") {
                                                  value = "bernkastel";
                                                }
                                                else {
                                                  value = myselect.value;
                                                }
                                                document.getElementById("locationList").value = value;
                                              }
                                              </script>

                                                <option value="" disabled selected>City</option>
<!--                                                <option value="goettingen">Göttingen (Niedersachsen)</option>
                                                <option value="biberach">Biberach (Baden-Württemberg)</option>
                                                <option value="aachen">Aachen (Nordrhein-Westfalen)</option>
                                                <option value="trier">Trier (Rheinland-Pfalz)</option>
                                                <option value="augsburg">Augsburg (Bavaria)</option>
                                                <option value="regensburg">Regensburg (Bavaria)</option>
                                                <option value="chemnitz">Chemnitz (Sachsen)</option>
                                                <option value="neubrandenburg">Neubrandenburg (Mecklenburg-Vorpommern)</option>
                                                <option value="schwerin">Schwerin (Mecklenburg-Vorpommern)</option>
                                                <option value="kiel">Kiel (Schleswig-Holstein)</option>-->

                                                <!--New cities-->
                                                <option value="bengel">Bengel (Rheinland-Pfalz)</option>
                                                <option value="cochem">Cochem (Rheinland-Pfalz)</option>
                                                <option value="bernkastel_kues">Bernkastel-Kues (Rheinland-Pfalz)</option>
                                                <option value="muelheim">Mülheim (Rheinland-Pfalz)</option>
                                                <option value="zell">Zell (Rheinland-Pfalz)</option>
                                            </select>
                                        </div>

                                        {% comment %} 2 raw {% endcomment %}
                                        <div class="row" style="height:500px;">
                                            <div class="col">
                                                <p style="position: relative; margin: 0px 0px; left: 326px; font-size: 16px; width: 20px;">Hochwasser</p>
                                                <img id="flood-prediction-image" alt="plot_flood_prediction" style="width: 100%;">
                                                <p id="warning_pred_1"> Please, select City. </p>
                                            </div>
                                            <div class="col">
                                                <p style="position: relative; margin: 0px 0px; left: 326px; font-size: 16px; width: 20px;">Starkregen</p>
                                                <img id="starkregen-prediction-image" alt="plot_starkregen_prediction" style="width: 100%;">
                                                <p id="warning_pred_2"> Please, select City. </p>
                                            </div>
                                        </div>

                                        {% comment %} 3 raw {% endcomment %}
                                        <div class="row"  style="height:500px; margin-top: 35px;">
                                            <div class="col">

                                                <p style="position: relative; margin: 0px 0px; left: 326px; font-size: 16px; width: 20px;">Schnee</p>
                                                <img id="snow-prediction-image" alt="plot_snow_prediction" style="width: 100%;">
                                                <p id="warning_pred_4"> Please, select City. </p>
                                            </div>
                                            <div class="col">

                                                <p style="position: relative; margin: 0px 0px; left: 326px; font-size: 16px; width: 20px;">Sonstige</p>
                                                <img id="others-prediction-image" alt="plot_others_prediction" style="width: 100%;">
                                                <p id="warning_pred_3"> Please, select City. </p>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <script>
                                $(document).ready(function() {
                                    // Listen for the change event of the dropdown select element

                                    $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ empty_plot }}');
                                    $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ empty_plot }}');
                                    $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ empty_plot }}');
                                    $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ empty_plot }}');

                                    $('#city-dropdown').change(function() {
                                        var selectedCity = $(this).val();

                                        // Update the image source based on the selected city
                                        if (selectedCity === 'goettingen') {

                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_goettingen }}');
                                            $('#flood-prediction-image').attr('city', 'goettingen');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_goettingen }}');
                                            $('#starkregen-prediction-image').attr('city', 'goettingen');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_goettingen }}');
                                            $('#others-prediction-image').attr('city', 'goettingen');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_goettingen }}');
                                            $('#snow-prediction-image').attr('city', 'goettingen');
                                            $('#warning_pred_4').css('display', 'none');
                                        }else if (selectedCity === 'biberach') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_biberach }}');
                                            $('#flood-prediction-image').attr('city', 'biberach');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_biberach }}');
                                            $('#starkregen-prediction-image').attr('city', 'biberach');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_biberach }}');
                                            $('#others-prediction-image').attr('city', 'biberach');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_biberach }}');
                                            $('#snow-prediction-image').attr('city', 'biberach');
                                            $('#warning_pred_4').css('display', 'none');
                                        }else if (selectedCity === 'trier') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_trier }}');
                                            $('#flood-prediction-image').attr('city', 'trier');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_trier }}');
                                            $('#starkregen-prediction-image').attr('city', 'trier');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_trier }}');
                                            $('#others-prediction-image').attr('city', 'trier');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_trier }}');
                                            $('#snow-prediction-image').attr('city', 'trier');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'augsburg') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_augsburg }}');
                                            $('#flood-prediction-image').attr('city', 'augsburg');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_augsburg }}');
                                            $('#starkregen-prediction-image').attr('city', 'augsburg');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_augsburg }}');
                                            $('#others-prediction-image').attr('city', 'augsburg');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_augsburg }}');
                                            $('#snow-prediction-image').attr('city', 'augsburg');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'regensburg') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_regensburg }}');
                                            $('#flood-prediction-image').attr('city', 'regensburg');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_regensburg }}');
                                            $('#starkregen-prediction-image').attr('city', 'regensburg');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_regensburg }}');
                                            $('#others-prediction-image').attr('city', 'regensburg');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_regensburg }}');
                                            $('#snow-prediction-image').attr('city', 'regensburg');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'chemnitz') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_chemnitz }}');
                                            $('#flood-prediction-image').attr('city', 'chemnitz');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_chemnitz }}');
                                            $('#starkregen-prediction-image').attr('city', 'chemnitz');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_chemnitz }}');
                                            $('#others-prediction-image').attr('city', 'chemnitz');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_chemnitz }}');
                                            $('#snow-prediction-image').attr('city', 'chemnitz');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'neubrandenburg') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_neubrandenburg }}');
                                            $('#flood-prediction-image').attr('city', 'neubrandenburg');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_neubrandenburg }}');
                                            $('#starkregen-prediction-image').attr('city', 'neubrandenburg');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_neubrandenburg }}');
                                            $('#others-prediction-image').attr('city', 'neubrandenburg');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_neubrandenburg }}');
                                            $('#snow-prediction-image').attr('city', 'neubrandenburg');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'schwerin') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_schwerin }}');
                                            $('#flood-prediction-image').attr('city', 'schwerin');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_schwerin }}');
                                            $('#starkregen-prediction-image').attr('city', 'schwerin');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_schwerin }}');
                                            $('#others-prediction-image').attr('city', 'schwerin');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_schwerin }}');
                                            $('#snow-prediction-image').attr('city', 'schwerin');
                                            $('#warning_pred_4').css('display', 'none');
                                        } else if (selectedCity === 'kiel') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', 'data:image/png;base64,{{ plot_flood_prediction_kiel }}');
                                            $('#flood-prediction-image').attr('city', 'kiel');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', 'data:image/png;base64,{{ plot_heavy_rain_prediction_kiel }}');
                                            $('#starkregen-prediction-image').attr('city', 'kiel');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', 'data:image/png;base64,{{ plot_others_prediction_kiel }}');
                                            $('#others-prediction-image').attr('city', 'kiel');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', 'data:image/png;base64,{{ plot_snow_prediction_kiel }}');
                                            $('#snow-prediction-image').attr('city', 'kiel');
                                            $('#warning_pred_4').css('display', 'none');
                                        }
                                        else if (selectedCity === 'aachen') {
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_aachen.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'aachen');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_aachen.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'aachen');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_prediction_aachen.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'aachen');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_prediction_aachen.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'aachen');
                                            $('#warning_pred_4').css('display', 'none');

                                        } else if (selectedCity === 'bengel'){
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_bangel.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'bengel');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_bangel.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'bengel');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_prediction_bangel.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'bengel');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_bangel.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'bengel');
                                            $('#warning_pred_4').css('display', 'none');

                                        } else if (selectedCity === 'cochem'){
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_cochem.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'cochem');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_cochem.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'cochem');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_prediction_cochem.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'cochem');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_cochem.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'cochem');
                                            $('#warning_pred_4').css('display', 'none');

                                        } else if (selectedCity === 'bernkastel_kues'){
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_bernkastel_kues.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'bernkastel_kues');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_bernkastel_kues.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'bernkastel_kues');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_bernkastel_kues.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'bernkastel_kues');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_bernkastel_kues.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'bernkastel_kues');
                                            $('#warning_pred_4').css('display', 'none');

                                        } else if (selectedCity === 'muelheim'){
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_muelheim.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'muelheim');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_muelheim.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'muelheim');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_prediction_muelheim.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'muelheim');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_muelheim.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'muelheim');
                                            $('#warning_pred_4').css('display', 'none');

                                        } else if (selectedCity === 'zell'){
                                            //Flood
                                            $('#flood-prediction-image').attr('src', `{% static "img/plot_flood_prediction_zell.svg" %}`);
                                            $('#flood-prediction-image').attr('city', 'zell');
                                            $('#warning_pred_1').css('display', 'none');
                                            //Heavy rain
                                            $('#starkregen-prediction-image').attr('src', `{% static "img/plot_heavy_rain_prediction_zell.svg" %}`);
                                            $('#starkregen-prediction-image').attr('city', 'zell');
                                            $('#warning_pred_2').css('display', 'none');
                                            //Other
                                            $('#others-prediction-image').attr('src', `{% static "img/plot_other_prediction_zell.svg" %}`);
                                            $('#others-prediction-image').attr('city', 'zell');
                                            $('#warning_pred_3').css('display', 'none');
                                            //Snow
                                            $('#snow-prediction-image').attr('src', `{% static "img/plot_snow_zell.svg" %}`);
                                            $('#snow-prediction-image').attr('city', 'zell');
                                            $('#warning_pred_4').css('display', 'none');

                                        }

                                    });
                                });
                            </script>




                            <div class="mapContainer">
                                <div id="map" style="width: 97%;height: 65vh;position: relative;margin-left: 40px;">

                                </div>
                            </div>

                            <script>
                                $('button[ data-bs-toggle="tab"]').on('shown.bs.tab', function(e) {
                                    if (e.target.id === "event-pred-tab") {
                                        initMap();
                                    }
                                });

                                function initMap() {

                                    map = L.map('map', {
                                        center: [50.841755, 9.575857],
                                        zoom: 6
                                    });

                                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                        maxZoom: 19,
                                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                                    }).addTo(map);

                                    var Aachen = [50.770182, 6.089658]
                                    var Augsburg = [48.3668041, 10.8986971]
                                    var Trier = [49.7596208, 6.6441878]
                                    var Biberach = [48.339971, 8.032849]
                                    var Göttingen = [51.5328328, 9.9351811]
                                    var Regensburg = [49.0195333, 12.0974869]
                                    var Chemnitz = [50.8322608 , 12.9252977]
                                    var Neubrandenburg = [53.5574458, 13.2602781]
                                    var Schwerin = [53.6288297, 11.4148038]
                                    var Kiel = [54.3227085, 10.135555]
                                    //
                                    var Bengel = [50.016564, 7.064047]
                                    var Cochem = [50.147709, 7.170171]
                                    var Bernkastel_Kues = [49.919602, 7.068205]
                                    var Muelheim = [49.912942, 7.010353]
                                    var Zell = [50.036760, 7.177282]

                                    //1
                                    var dataWeatherGöttingen = {{get_weather_goettingen  | safe}}
                                    popupContentGöttingen = generateTableRows(dataWeatherGöttingen, "Göttingen (Niedersachsen)")
                                    //2
                                    var dataWeatherTrier = {{get_weather_trier  | safe}}
                                    popupContentTrier = generateTableRows(dataWeatherTrier, "Trier (Rheinland-Pfalz)")
                                    //3
                                    var dataWeatherAugsburg = {{get_weather_augsburg  | safe}}
                                    popupContentAugsburg = generateTableRows(dataWeatherAugsburg, "Augsburg(Bavaria)")
                                    //4
                                    var dataWeatherBiberach = {{get_weather_biberach  | safe}}
                                    popupContentBiberach = generateTableRows(dataWeatherBiberach, "Biberach (Baden-Württemberg)")

                                    //5 Constant values
                                    popupContentAachen = generateTableRows("hardcoded", "Aachen (Nordrhein-Westfalen)")
                                    //6
                                    var dataWeatherRegensburg = {{get_weather_regensburg  | safe}}
                                    popupContentRegensburg = generateTableRows(dataWeatherRegensburg, "Regensburg (Bavaria)")
                                    //7
                                    var dataWeatherChemnitz = {{get_weather_chemnitz  | safe}}
                                    popupContentChemnitz = generateTableRows(dataWeatherChemnitz, "Chemnitz (Sachsen)")
                                    //8
                                    var dataWeatherNeubrandenburg = {{get_weather_neubrandenburg  | safe}}
                                    popupContentNeubrandenburg = generateTableRows(dataWeatherNeubrandenburg, "Neubrandenburg (Mecklenburg-Vorpommern)")
                                    //9Kiel
                                    var dataWeatherSchwerin = {{get_weather_schwerin  | safe}}
                                    popupContentSchwerin = generateTableRows(dataWeatherSchwerin, "Schwerin (Mecklenburg-Vorpommern)")
                                    //10
                                    var dataWeatherKiel = {{get_weather_kiel  | safe}}
                                    popupContentKiel = generateTableRows(dataWeatherKiel, "Kiel (Schleswig-Holstein)")
                                    //11
                                    //var dataWeatherBengel = {{get_weather_bengel | safe}}
                                    popupContentBengel = generateTableRows("hardcoded", "Bengel (Rheinland-Pfalz)")
                                    //12 Cochem
                                    popupContentCochem = generateTableRows("hardcoded", "Cochem (Rheinland-Pfalz)")
                                    //13 Bernkastel_Kues
                                    popupContentBernkastel_Kues = generateTableRows("hardcoded", "Bernkastel-Kues (Rheinland-Pfalz)")
                                    //14 Muelheim
                                    popupContentMuelheim = generateTableRows("hardcoded", "Mülheim (Rheinland-Pfalz)")
                                    //15
                                    popupContentZell = generateTableRows("hardcoded", "Zell (Rheinland-Pfalz)")

                                    //Add Markers to the map
                                    L.Icon.Default.prototype.options.popupAnchor = [0, -65];

                                     /*//1
                                    L.marker(Biberach).addTo(map).bindPopup(popupContentBiberach, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //2
                                    L.marker(Göttingen).addTo(map).bindPopup(popupContentGöttingen, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //3
                                    L.marker(Aachen).addTo(map).bindPopup(popupContentAachen, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //4
                                    L.marker(Trier).addTo(map).bindPopup(popupContentTrier, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //5
                                    L.marker(Augsburg).addTo(map).bindPopup(popupContentAugsburg, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //6
                                    L.marker(Regensburg).addTo(map).bindPopup(popupContentRegensburg, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //7
                                    L.marker(Chemnitz).addTo(map).bindPopup(popupContentChemnitz, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });

                                    //8
                                    L.marker(Neubrandenburg).addTo(map).bindPopup(popupContentNeubrandenburg, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //9
                                    L.marker(Schwerin).addTo(map).bindPopup(popupContentSchwerin, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //10
                                    L.marker(Kiel).addTo(map).bindPopup(popupContentKiel, {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });*/

                                    //11
                                    L.marker(Bengel).addTo(map).bindPopup(popupContentBengel , {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //12 Cochem
                                    L.marker(Cochem).addTo(map).bindPopup(popupContentCochem , {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //13
                                    L.marker(Bernkastel_Kues).addTo(map).bindPopup(popupContentBernkastel_Kues , {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //14
                                    L.marker(Muelheim).addTo(map).bindPopup(popupContentMuelheim , {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                    //15
                                    L.marker(Zell).addTo(map).bindPopup(popupContentZell , {
                                        className: 'custom-popup',
                                        maxWidth: 'auto'
                                    });
                                }
                            </script>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="plan-recom" role="tabpanel" aria-labelledby="plan-recom-tab">

                        <!--json-->
                        <div class="mt-5 row">
                          {% load static %}
                          <script src="{% static 'opp/main.js' %}"></script>
                          <script src="{% static 'opp/query.js' %}"></script>

                          <p>To generate planning recommendations, please select the desired input information. </p>
                          {% include "opp/user_input.html" %}

                          <br>
                          <h5>Event Context</h5>
                          {% include "opp/event_context.html" %}

                          <h5>Historical Events</h5>
                          <p> Specifics of the found historical events can be viewed in the graph visualization. Hover over the nodes to see details.</p>
                          {% include "opp/graph.html" %}

                          <br>
                          <h5>Tasks</h5>
                          {% include "opp/task_context.html" %}

                          <br>
                          <h5>Units & Personnel</h5>
                          {% include "opp/unit_context.html" %}

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Copyright footer-->
        <footer class="bg-light text-center text-lg-start" style="height:100%">

            <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.2);height: 70px;">
                © 2023 Copyright:
                <a class="text-dark"
                href="https://www.dfki.de/web/forschung/projekte-publikationen/projekte-uebersicht/projekt/pairs/">DFKI_PAIRS</a>
            </div>

        </footer>

    </body>
</html>
